<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Timetable</title>

  <style>
    :root {
      --bg: #ffffff;
      --text: #111;
      --muted: #f6f8fa;
      --border: #dee2e6;
      --highlight: #fff3bf;
      --accent: #0b69a3;
      --current-period-bg: #d1f7d6;
      --next-period-bg: #cfe2ff;
      --lab-bg: #e0eaff;
      --lab-text: #002266;
      --class-bg: #e2f5e7;
      --class-text: #0c4b1d;
    }

    body.dark {
      --bg: #0f1113;
      --text: #e6eef6;
      --muted: #1c2128;
      --border: #444c56;
      --highlight: #5a4300;
      --current-period-bg: #0b411a;
      --next-period-bg: #1c325c;
      --lab-bg: #2a3d61;
      --lab-text: #c4d7ff;
      --class-bg: #204934;
      --class-text: #a2e8b9;
    }

    body {
      margin: 0;
      padding: 12px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: var(--bg);
      color: var(--text);
      transition: background .18s, color .18s;
    }

    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    button#darkToggle {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      cursor: pointer;
      font-weight: 600;
    }

    .wrap {
      overflow: auto;
      border-radius: 8px;
      border: 1px solid var(--border);
      -webkit-overflow-scrolling: touch;
    }

    table.timetable {
      border-collapse: collapse;
      min-width: 940px;
      width: 100%;
      table-layout: fixed;
      font-size: 14px;
      padding-right: 40vw; /* Fix for centering the last column */
    }

    thead th {
      background: var(--muted);
      padding: 10px;
      border: 1px solid var(--border);
      text-align: left;
      font-weight: 700;
    }

    th.time-col,
    td.time-col {
      position: sticky;
      left: 0;
      z-index: 100;
      background-color: var(--bg) !important;
      border-right: 2px solid var(--border);
      min-width: 90px;
      width: 90px;
      text-align: center;
      font-weight: 700;
      padding: 10px;
      box-shadow: 4px 0 8px -4px rgba(0, 0, 0, 0.06);
      transform: translateZ(0);
    }

    thead th.time-col {
      z-index: 110;
    }

    td {
      padding: 8px;
      border: 1px solid var(--border);
      vertical-align: middle;
      height: 60px;
      text-align: center;
      box-sizing: border-box;
      transition: background-color 0.3s ease;
    }

    .abbr {
      display: block;
      font-weight: 700;
      font-size: 13px;
    }

    .room {
      display: block;
      font-size: 12px;
      margin-top: 4px;
      opacity: 0.9;
    }
    
    .type {
      display: inline-block;
      font-size: 11px;
      margin-top: 5px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 4px;
    }

    .type-lab {
      background-color: var(--lab-bg);
      color: var(--lab-text);
    }

    .type-class {
      background-color: var(--class-bg);
      color: var(--class-text);
    }

    tbody tr:nth-child(even) td {
      background-color: rgba(120, 120, 120, 0.04);
    }

    @media screen {
      thead th.today {
        background-color: var(--highlight) !important;
      }
      td.today {
        background-color: var(--highlight) !important;
      }
      td.current-period {
        background-color: var(--current-period-bg) !important;
        font-weight: 700;
      }
      td.next-period {
        background-color: var(--next-period-bg) !important;
      }
    }

    @media print {
      .no-print { display: none !important; }
      th, td { background: transparent !important; box-shadow: none !important; }
      th.time-col, td.time-col { position: static; }
      .type { background: transparent !important; border: 1px solid #ccc; color: #333 !important; }
    }

    .wrap.scrolling th.time-col,
    .wrap.scrolling td.time-col {
      box-shadow: 6px 0 10px -4px rgba(0, 0, 0, 0.15);
    }

    .legend {
      margin-top: 14px;
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .legend th, .legend td {
      padding: 8px;
      border: 1px solid var(--border);
      text-align: left;
    }
    .legend thead th {
      background: var(--muted);
      font-weight: 700;
    }

    @media (max-width: 760px) {
      body { padding: 8px; }
      th.time-col, td.time-col { min-width: 80px; width: 80px; font-size: 13px; }
      td, th { padding: 8px; font-size: 12px; }
      .abbr { font-size: 12px; }
      .room { font-size: 11px; }
      table.timetable, .legend { min-width: 800px; }
    }
  </style>
</head>

<body>

  <div class="controls no-print">
    <button id="darkToggle">Enable Dark Mode</button>
  </div>

  <div class="wrap">
    <table class="timetable" id="timetable" aria-describedby="legend">
      <thead>
        <tr>
          <th class="time-col">Time</th>
          <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
        </tr>
      </thead>
      <tbody>
        <tr><td class="time-col">08:00 AM</td><td></td><td></td><td></td><td rowspan="2"><span class="abbr">DMPA</span><span class="room">E551</span><span class="type type-class">Class</span></td><td rowspan="2"><span class="abbr">DLUP</span><span class="room">E551</span><span class="type type-class">Class</span></td><td rowspan="2"><span class="abbr">LLM</span><span class="room">E551</span><span class="type type-class">Class</span></td><td></td></tr>
        <tr><td class="time-col">09:00 AM</td><td></td><td></td><td></td><td></td></tr>
        <tr><td class="time-col">10:00 AM</td><td></td><td></td><td></td><td><span class="abbr">MTES</span><span class="room">E551</span><span class="type type-class">Class</span></td><td></td><td><span class="abbr">MTES</span><span class="room">E551</span><span class="type type-class">Class</span></td><td></td></tr>
        <tr><td class="time-col">11:00 AM</td><td></td><td></td><td></td><td rowspan="2"><span class="abbr">SEA</span><span class="room">E551</span><span class="type type-class">Class</span></td><td rowspan="2"><span class="abbr">LLM</span><span class="room">E551</span><span class="type type-class">Class</span></td><td rowspan="2"><span class="abbr">DMPA</span><span class="room">E551</span><span class="type type-class">Class</span></td><td></td></tr>
        <tr><td class="time-col">12:00 PM</td><td></td><td></td><td></td><td></td></tr>
        <tr><td class="time-col">01:00 PM</td><td colspan="7"></td></tr>
        <tr><td class="time-col">02:00 PM</td><td rowspan="2"><span class="abbr">PRPWA</span><span class="room">E306</span><span class="type type-lab">Lab</span></td><td><span class="abbr">DLUP</span><span class="room">E551</span><span class="type type-class">Class</span></td><td rowspan="2"><span class="abbr">PRPWA</span><span class="room">E306</span><span class="type type-lab">Lab</span></td><td></td><td></td><td></td><td></td></tr>
        <tr><td class="time-col">03:00 PM</td><td><span class="abbr">MTES</span><span class="room">E551</span><span class="type type-class">Class</span></td><td></td><td></td><td></td><td></td></tr>
        <tr><td class="time-col">04:00 PM</td><td><span class="abbr">MTES</span><span class="room">E551</span><span class="type type-class">Class</span></td><td rowspan="2"><span class="abbr">PRPWA</span><span class="room">E306</span><span class="type type-lab">Lab</span></td><td><span class="abbr">SEA</span><span class="room">E551</span><span class="type type-class">Class</span></td><td></td><td></td><td></td><td></td></tr>
        <tr><td class="time-col">05:00 PM</td><td><span class="abbr">DLUP</span><span class="room">E551</span><span class="type type-class">Class</span></td><td><span class="abbr">SEA</span><span class="room">E551</span><span class="type type-class">Class</span></td><td></td><td></td><td></td><td></td></tr>
        <tr><td class="time-col">06:00 PM</td><td colspan="7"></td></tr>
      </tbody>
    </table>
  </div>

  <h3 id="legend">Legend</h3>
  <div class="wrap">
      <table class="legend" role="table" aria-label="Legend">
        <thead>
          <tr>
            <th>Abbrev</th><th>Subject (full)</th><th>Subject Code</th><th>Teacher</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><strong>PRPWA</strong></td><td>Practical Robotics Projects with Arduino</td><td>CSE4571</td><td>BHABASIS MOHAPATRA</td></tr>
          <tr><td><strong>DLUP</strong></td><td>Deep Learning using Python</td><td>CSE4685</td><td>Mohinikanta Sahoo</td></tr>
          <tr><td><strong>MTES</strong></td><td>Management Topics in Environmental Studies</td><td>CHM2049</td><td>Naresh Kumar Sahoo</td></tr>
          <tr><td><strong>SEA</strong></td><td>Software Engineering Approach</td><td>CSE4658</td><td>Prity Hansda</td></tr>
          <tr><td><strong>DMPA</strong></td><td>Data Mining &amp; Predictive Analytics</td><td>CSE4859</td><td>Utpal Poddar</td></tr>
          <tr><td><strong>LLM</strong></td><td>Large Language Models</td><td>CSE4375</td><td>Radhamadhab Dalai</td></tr>
        </tbody>
      </table>
  </div>

  <script>
    // Main timetable logic
    (function () {
      const table = document.getElementById('timetable');
      if (!table) return;

      const wrap = document.querySelector('.wrap');
      const tbody = table.tBodies[0];
      const rows = Array.from(tbody.rows);
      const R = rows.length;
      const C = 7;

      // 1. Build the grid for rowspan/colspan mapping
      const grid = Array.from({ length: R }, () => Array(C).fill(null));
      for (let r = 0; r < R; r++) {
        let c = 0;
        const cells = Array.from(rows[r].cells).slice(1);
        for (const cell of cells) {
          while (grid[r][c] !== null) c++;
          const colspan = cell.colSpan || 1;
          const rowspan = cell.rowSpan || 1;
          for (let rr = 0; rr < rowspan; rr++) {
            for (let cc = 0; cc < colspan; cc++) {
              if (r + rr < R && c + cc < C) grid[r + rr][c + cc] = cell;
            }
          }
          c += colspan;
        }
      }

      // 2. Parse time slots from the first column
      const timeSlots = rows.map((row, index) => {
          const timeText = row.cells[0].textContent.trim();
          const [time, modifier] = timeText.split(' ');
          let [hours, minutes] = time.split(':').map(Number);
          if (modifier === 'PM' && hours < 12) hours += 12;
          if (modifier === 'AM' && hours === 12) hours = 0;
          return {
              startMinutes: hours * 60 + minutes,
              rowIndex: index
          };
      });

      // 3. Main highlight function
      function updateHighlights() {
          const now = new Date();
          const todayD = now.getDay();
          const targetCol = (todayD === 0) ? 6 : (todayD - 1);
          const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();

          tbody.querySelectorAll('.current-period, .next-period').forEach(el => {
              el.classList.remove('current-period', 'next-period');
          });

          let currentPeriodFound = false;
          for (let i = 0; i < timeSlots.length; i++) {
              const slot = timeSlots[i];
              const nextSlot = timeSlots[i + 1] || { startMinutes: slot.startMinutes + 60 };
              const cell = grid[slot.rowIndex][targetCol];
              if (!cell || cell.colSpan > 1) continue;

              if (!currentPeriodFound && currentTimeInMinutes >= slot.startMinutes && currentTimeInMinutes < nextSlot.startMinutes) {
                  cell.classList.add('current-period');
                  currentPeriodFound = true;
                  for (let j = i + 1; j < timeSlots.length; j++) {
                      const nextCell = grid[timeSlots[j].rowIndex][targetCol];
                      if (nextCell && nextCell !== cell && nextCell.colSpan === 1) {
                          nextCell.classList.add('next-period');
                          break;
                      }
                  }
              }
          }
      }

      // 4. Scrolling function for both horizontal and vertical
      function scrollToCurrent() {
        // Horizontal scroll to day
        const todayD = new Date().getDay();
        const headerIndex = (todayD === 0) ? 8 : (todayD + 1);
        const hdr = table.querySelector(`thead tr th:nth-child(${headerIndex})`);
        if (hdr) {
          const hdrRect = hdr.getBoundingClientRect();
          const wrapRect = wrap.getBoundingClientRect();
          const delta = (hdrRect.left + hdrRect.width / 2) - (wrapRect.left + wrapRect.width / 2);
          wrap.scrollTo({ left: wrap.scrollLeft + delta, behavior: 'smooth' });
        }

        // Vertical scroll to time
        const currentPeriodCell = tbody.querySelector('.current-period');
        if (currentPeriodCell) {
          setTimeout(() => { // Small delay to allow horizontal scroll to start
            currentPeriodCell.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }, 400);
        }
      }

      // 5. Initial setup & intervals
      const todayD = new Date().getDay();
      const headerNth = (todayD === 0) ? 8 : (todayD + 1);
      const headCell = table.querySelector(`thead th:nth-child(${headerNth})`);
      if (headCell) headCell.classList.add('today');
      
      const targetCol = (todayD === 0) ? 6 : (todayD - 1);
      for (let r = 0; r < R; r++) {
          const cell = grid[r][targetCol];
          if (cell && cell.colSpan === 1) cell.classList.add('today');
      }
      
      updateHighlights();
      setInterval(updateHighlights, 60000);

      // Scroll into view on load after a delay
      setTimeout(scrollToCurrent, 500);

      // 6. UI functionality (Dark Mode, etc.)
      const toggle = document.getElementById('darkToggle');
      function applyDark(isDark) {
          document.body.classList.toggle('dark', !!isDark);
          toggle.textContent = !!isDark ? 'Light Mode' : 'Dark Mode';
      }
      const stored = localStorage.getItem('tt-dark');
      applyDark(stored === '1');
      toggle.addEventListener('click', () => {
          const now = document.body.classList.toggle('dark');
          localStorage.setItem('tt-dark', now ? '1' : '0');
          toggle.textContent = now ? 'Light Mode' : 'Dark Mode';
      });

    })();
  </script>

</body>
</html>